<script>
  var scripts = document.getElementsByTagName("script");
  for (var i = 0; i < scripts.length; i++) {
    var script = scripts[i];
    if (script.type.match(/^math\/tex/)) {
      var text = script.text === "" ? script.innerHTML : script.text;
      if (script.type.match(/mode\s*=\s*display/)) {
        text = "\\displaystyle {" + text + "}";
      }
      script.insertAdjacentHTML("beforebegin", katex.renderToString(text));
    }
  }
</script>